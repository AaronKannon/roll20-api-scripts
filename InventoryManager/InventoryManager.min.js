var Localization={coins:"Goldwert",coin_copper:"KM",coin_silver:"SM",coin_electrum:"EM",coin_gold:"GM",coin_platinum:"PM",weight:"Traglast",warmth:"Wärme",hospitality:"Komfort",profile:"Profil",storage_backpack:"Rucksack",storage_quiver:"Köcher",storage_boltcase:"Bolzenköcher",storage_pouch:"Beutel",storage_bagofholding:"Nimmervoller Beutel",storage_hhh:"Praktischer Tornister",storage_hhhside1:"Tornister Seitenfach",storage_hhhside2:"Tornister Seitenfach",storage_chest:"Kiste",storage_cart:"Karren",storage_pocket:"Tasche"},RoubysInventoryManager={playerList:["","-JglZwTIFm0ivfDzMssH","-JggSWGNp1gDvfdZSTPf","-JglZlSBA2oSX2ClDirs","-JglZlRofAw79n0D-2ol","-JglZwTIFm0ivfDzMssH,-JggSWGNp1gDvfdZSTPf,-JglZlSBA2oSX2ClDirs,-JglZlRofAw79n0D-2ol"],logPlayerIds:!0,inventoryTokenImage:"https://s3.amazonaws.com/files.d20.io/images/7359609/N7-rgMNvKG5czBsAXGD-Mw/thumb.png?1422290877",coin:{weight:.02,volume:4e-5,value_copper:.01,value_silver:.1,value_electrum:.2,value_gold:1,value_platinum:10},temperatureUnit:"C",storageItems:[{name:"backpack",maxWeight:30,maxVolume:1},{name:"quiver",maxWeight:1,maxVolume:.1},{name:"boltcase",maxWeight:1.5,maxVolume:.15},{name:"pouch",maxWeight:6,maxVolume:.2},{name:"pocket",maxWeight:3,maxVolume:.1},{name:"bagofholding",maxWeight:500,maxVolume:64},{name:"hhh",maxWeight:80,maxVolume:8},{name:"hhhside",maxWeight:20,maxVolume:2},{name:"chest",maxWeight:300,maxVolume:12},{name:"cart",maxWeight:600,maxVolume:50}],debugMode:!1,objsToBeCreated:[],lastRun:Date.now(),run:function(){var n=Date.now();n-RoubysInventoryManager.lastRun>1e3&&(RoubysInventoryManager.process(),_.each(RoubysInventoryManager.objsToBeCreated,function(n){RoubysInventoryManager.createInventory(n.pageId,n.name,n.left,n.top,n.id,n.weight,n.volume)}),RoubysInventoryManager.objsToBeCreated=[],RoubysInventoryManager.lastRun=n)},createInventory:function(n,t,i,r,u,f,e){setTimeout(function(){toBack(RoubysInventoryManager.fixedCreateObj("graphic",{name:t,imgsrc:RoubysInventoryManager.inventoryTokenImage,pageid:n,left:i+280,top:r,width:70,height:70,bar1_value:0,bar1_max:f,bar2_value:0,bar2_max:e,layer:"objects",gmnotes:"inv rep_"+u}))},5)},fixedCreateObj:function(){var n=createObj.apply(this,arguments);return n&&!n.fbpath&&(n.fbpath=n.changed._fbpath.replace(/([^\/]*\/){4}/,"/")),n},process:function(){function l(n){return _.reduceRight(h.exec(n),function(n,t){return n||t},null)||"item"}function a(n){var t=null,r={unstowable:!1,constantweight:!1,liquid:!1,hosp:!1,storage:!1};for(i.lastIndex=0;t=i.exec(n);)r[t[0].toLowerCase()]=!!_.reduceRight(t,function(n,t){return n||t},null);return r}function v(n){var t=null,u={weight:null,warmth:null,coins:null,rep:null,weightfactor:null},i,f;for(r.lastIndex=0;t=r.exec(n);)i=-1,f=_.reduceRight(t,function(n,t,r){return n||(i=r),n||t},null),u[t[i-1].toLowerCase()]=f;return u}function t(n,t){var i=t.get("width")/2,r=t.get("height")/2,u=t.get("left")-i,f=t.get("top")-r,e=t.get("left")+i,o=t.get("top")+r;return n.get("left")>=u&&n.get("top")>=f&&n.get("left")<=e&&n.get("top")<=o}var h=/(main)|(inv)|(worn)|(drop)|(ignore)|(status\d?)/,i=/(unstowable)|(constantweight)|(liquid)|(hosp)|(storage)/ig,r=/(?:(weight)%20([\d\.,]+))|(?:(warmth)%20(\d+))|(?:(coins)%20(\S+))|(?:(rep)_(\S+))|(?:(weightfactor)%20([\d\.,]+))/ig,c=/(\d+)x/,u=[],f=[],e=[],o=[],n=[],s=[],y=findObjs({_pageid:Campaign().get("playerpageid"),_type:"graphic"});_.each(y,function(t){var y=t.get("gmnotes"),p=l(y),s=a(y),h=v(y),i={type:p,graphic:t},r={statusmarkers:"!",showplayers_name:!0,showname:!0,showplayers_bar1:!1,showplayers_bar2:!1,showplayers_bar3:!1,playersedit_bar1:!1,playersedit_bar2:!1,playersedit_bar3:!1};switch(p){case"main":u.push(i);r.showname=!1;break;case"status":case"status2":case"status3":f.push(i);t.get("bar1_max")>0&&(r.showplayers_bar1=!0);break;case"worn":i.properties={isSlot:!0};e.push(i);break;case"inv":i.properties={representId:h.rep};r.showplayers_bar1=!0;r.showplayers_bar2=!0;case"drop":o.push(i);break;case"ignore":break;default:i.properties={equippedAt:null,isLiquidContainer:s.liquid,isUnstowable:s.unstowable,coinType:h.coins,coinAmount:h.coins?parseFloat(t.get("bar3_value")):0,baseWeight:parseFloat(h.weight||0),warmthValue:parseInt(h.warmth||0),grantsHospitality:s.hosp,amount:parseInt(_.reduceRight(c.exec(t.get("name")),function(n,t){return n||t},null)||1),hasInventory:s.storage,inventories:[],hasConstantWeight:s.constantweight};n.push(i)}r.showname=r.showname&&_.isString(t.get("name"))&&t.get("name").length>1;t.set(r)});_.each(n,function(n){if(n.properties.coinType&&(n.graphic.set("bar1_value",Math.ceil(RoubysInventoryManager.coin.weight*n.properties.coinAmount*1e4)/1e4),n.graphic.set("bar2_value",Math.ceil(RoubysInventoryManager.coin.volume*n.properties.coinAmount*1e4)/1e4),n.graphic.set("name",Localization["coin_"+n.properties.coinType]+": "+n.properties.coinAmount)),n.properties.isLiquidContainer&&n.graphic.get("bar1_value")==0){var i=getObj("character",n.graphic.get("represents")),r=i?i.get("name"):"";n.graphic.set("name",r);n.graphic.set("tint_color","transparent")}_.each(e,function(i){if(t(n.graphic,i.graphic))if(n.properties.equippedAt=i,RoubysInventoryManager.debugMode&&n.graphic.set("status_grab",!0),n.properties.hasInventory)s.push(n.graphic.get("_id"));else{var r=n.graphic.get("gmnotes");_.each(RoubysInventoryManager.storageItems,function(t){for(var i=0;i<10&&r.indexOf(t.name)!==-1;++i)RoubysInventoryManager.objsToBeCreated.push({pageId:n.graphic.get("_pageid"),name:Localization["storage_"+t.name],left:n.graphic.get("left"),top:n.graphic.get("top"),id:n.graphic.get("_id"),weight:t.maxWeight*100,volume:t.maxVolume*100}),r=r.replace(t.name,"storage")});n.graphic.set("gmnotes",r)}})});_.each(o,function(i){if(i.containedItems=[],i.containedWeight=0,i.containedVolume=0,i.containedWeightMax=parseFloat(i.graphic.get("bar1_max"))/100,i.containedVolumeMax=parseFloat(i.graphic.get("bar2_max"))/100,_.each(n,function(n){t(n.graphic,i.graphic)?i.type==="inv"&&n.properties.isUnstowable?n.graphic.set("top",i.graphic.get("top")+i.graphic.get("height")/2+35):(i.containedItems.push(n),i.containedWeight+=parseFloat(n.graphic.get("bar1_value")*n.properties.amount)+n.properties.baseWeight,i.containedVolume+=parseFloat(n.graphic.get("bar2_value")*n.properties.amount),RoubysInventoryManager.debugMode&&n.graphic.set("status_fishing-net",!0)):i.type==="inv"&&n.properties.hasInventory&&n.graphic.get("_id")===i.properties.representId&&(n.properties.inventories.push(i),RoubysInventoryManager.debugMode&&(i.graphic.set("status_padlock",!0),n.graphic.set("status_padlock",!0)))}),i.type==="inv"){var r=s.indexOf(i.properties.representId)!==-1,u=i.containedWeight>i.containedWeightMax&&i.containedWeightMax>0||i.containedVolume>i.containedVolumeMax&&i.containedVolumeMax>0;i.graphic.set("bar1_value",Math.ceil(i.containedWeight*100));i.graphic.set("bar2_value",Math.ceil(i.containedVolume*100));i.graphic.set({status_dead:u});r?i.graphic.set("layer","objects"):i.graphic.set("layer","gmlayer")}else i.type==="drop"&&i.graphic.set("layer","map");_.each(i.containedItems,function(n){n.graphic.set("layer",i.graphic.get("layer"))})});_.each(u,function(i){i.containedWeight=0;i.containedVolume=0;i.containedCoinValue=0;_.each(n,function(n){if(t(n.graphic,i.graphic)&&n.graphic.get("layer")==="objects"){var r=RoubysInventoryManager.playerList[parseInt(i.graphic.get("bar3_value"))-1]||"";n.graphic.set("controlledby",r);!n.properties.containedIn&&n.properties.equippedAt&&(i.containedWeight+=parseFloat(n.graphic.get("bar1_value")*n.properties.amount)+n.properties.baseWeight,i.containedVolume+=parseFloat(n.graphic.get("bar2_value")*n.properties.amount),n.properties.coinType&&(i.containedCoinValue+=RoubysInventoryManager.coin["value_"+n.properties.coinType]*n.properties.coinAmount),n.properties.hasInventory&&!n.properties.hasConstantWeight&&_.each(n.properties.inventories,function(n){_.each(n.containedItems,function(n){n.graphic.set("controlledby",r);i.containedWeight+=parseFloat(n.graphic.get("bar1_value")*n.properties.amount)+n.properties.baseWeight;n.properties.coinType&&(i.containedCoinValue+=RoubysInventoryManager.coin["value_"+n.properties.coinType]*n.properties.coinAmount);RoubysInventoryManager.debugMode&&n.graphic.set("status_bleeding-eye",!0)})}),RoubysInventoryManager.debugMode&&n.graphic.set("status_bleeding-eye",!0))}});_.each(f,function(n){if(n.graphic.get("bar3_value")===i.graphic.get("bar3_value"))switch(n.type){case"status":var t=Math.ceil(i.containedWeight*100)/100,r=Math.ceil(i.containedVolume*100)/100,u=parseFloat(n.graphic.get("bar1_max"))/100,f=parseFloat(n.graphic.get("bar2_max"))/100,e=t>u&&u>0||r>f&&f>0;n.graphic.set("name",Localization.weight+": "+t+" | "+Localization.profile+": "+r);n.graphic.set("bar1_value",Math.ceil(t*100));n.graphic.set("bar2_value",Math.ceil(r*100));n.graphic.set({status_dead:e});break;case"status3":n.graphic.set("name",Localization.coins+": "+Math.floor(i.containedCoinValue))}})})}};on("ready",function(){RoubysInventoryManager.logPlayerIds&&(log("************* PLAYER IDs *************"),filterObjs(function(n){return n.get("type")=="player"&&log(n.get("_displayname")+": "+n.get("_id")),!1}),log("**************************************"));on("change:graphic:lastmove",function(n){RoubysInventoryManager.debugMode&&n.set({status_spanner:!0});RoubysInventoryManager.run()});on("add:graphic",function(n){n.set("width",70);n.set("height",70)})});
//# sourceMappingURL=InventoryManager.min.js.map
